-- ******** SCRIPT DE CRIAÇÃO DO BANCO DE DADOS DE UM SISTEMA QUE FAZ O GERENCIAMENTO DE UM PETSHOP ******************

-- ******* TABELA GERENTE *******
CREATE TABLE GERENTE(
ID_GERENTE INT NOT NULL AUTO_INCREMENT,
CODIGO_GERENTE CHAR(3) NOT NULL,
NOME VARCHAR(30) NOT NULL,
SOBRENOME VARCHAR(30) NOT NULL,
NOME_COMPLETO VARCHAR(100) ,
DATA_DE_NASCIMENTO DATE NOT NULL,
IDADE INT,
-- CHAVES:
PRIMARY KEY(ID_GERENTE)
);

-- CRIANDO TRIGGER QUE POPULA A COLUNA 'NOME_COMPLETO' DE ACORDO COM O VALOR DE 'NOME' E 'SOBRENOME' INSERIDOS:
DELIMITER $$ 

CREATE TRIGGER POPULAR_NOME_COMPLETO_GERENTE
BEFORE INSERT ON GERENTE 
FOR EACH ROW 
BEGIN 
	SET NEW.NOME_COMPLETO = CONCAT(NEW.NOME, ' ', NEW.SOBRENOME);
END $$

DELIMITER ;

-- CRIANDO TRIGGER QUE POPULA O CAMPO 'IDADE' DE ACORDO COM O VALOR PASSADO EM 'DATA_DE_NASCIMENTO':
DELIMITER $$
CREATE TRIGGER POPULAR_IDADE_GERENTE
BEFORE INSERT ON GERENTE
FOR EACH ROW

BEGIN
	SET NEW.IDADE = TIMESTAMPDIFF(YEAR, NEW.DATA_DE_NASCIMENTO, CURDATE());
END $$

DELIMITER ;

-- POPULANDO A TABELA:
INSERT INTO GERENTE(CODIGO_GERENTE, NOME, SOBRENOME, DATA_DE_NASCIMENTO)
VALUES
('G45', 'SERGIO', 'BARROS', '1980-02-12'),
('G63', 'ARTEMÁRIA', 'SANTOS', '1975-06-06');

-- ******** TABELA VETERINARIO *******************
CREATE TABLE VETERINARIO(
ID_VETERINARIO INT NOT NULL AUTO_INCREMENT,
CODIGO_VETERINARIO CHAR(3) NOT NULL,
NOME VARCHAR(30) NOT NULL,
SOBRENOME VARCHAR(30) NOT NULL,
NOME_COMPLETO VARCHAR(100) ,
DATA_DE_NASCIMENTO DATE NOT NULL,
IDADE INT,
SEXO CHAR(1) NOT NULL,
CODIGO_CFMV CHAR(5) NOT NULL,
ESPECIALIZACAO VARCHAR(30),
DATA_DE_ADMISSAO DATE NOT NULL,

-- CHAVES:
PRIMARY KEY(ID_VETERINARIO)
);

-- TRIGGER PARA NOME COMPLETO:
DELIMITER $$ 

CREATE TRIGGER POPULAR_NOME_COMPLETO_VETERINARIO
BEFORE INSERT ON VETERINARIO 
FOR EACH ROW 
BEGIN 
	SET NEW.NOME_COMPLETO = CONCAT(NEW.NOME, ' ', NEW.SOBRENOME);
END $$

DELIMITER ;

-- TRIGGER PARA IDADE:
DELIMITER $$

CREATE TRIGGER POPULAR_IDADE_VETERINARIO
BEFORE INSERT ON VETERINARIO
FOR EACH ROW
BEGIN
	SET NEW.IDADE = TIMESTAMPDIFF(YEAR, NEW.DATA_DE_NASCIMENTO, CURDATE());
END $$

DELIMITER ;

-- POPULANDO VALORES:
INSERT INTO VETERINARIO 
(CODIGO_VETERINARIO, NOME, SOBRENOME, DATA_DE_NASCIMENTO, SEXO, CODIGO_CFMV, ESPECIALIZACAO, DATA_DE_ADMISSAO)
VALUES
('V01', 'Marcos', 'Silva', '1985-07-12', 'M', '12345', 'Dermatologia', '2022-01-15'),
('V27', 'Ana', 'Souza', '1990-03-22', 'F', '98765', NULL, '2023-02-10'),
('V43', 'Pedro', 'Almeida', '1982-11-05', 'M', '54321', 'Cirurgia', '2021-12-01'),
('V09', 'Carla', 'Ferreira', '1987-05-19', 'F', '11111', 'Cardiologia', '2022-04-25'),
('V56', 'João', 'Pereira', '1992-08-30', 'M', '22222', NULL, '2023-05-10'),
('V78', 'Fernanda', 'Lima', '1980-01-10', 'F', '33333', 'Neurologia', '2021-09-14'),
('V65', 'Ricardo', 'Rodrigues', '1988-10-07', 'M', '44444', 'Oftalmologia', '2022-11-30'),
('V34', 'Mariana', 'Costa', '1991-12-25', 'F', '55555', NULL, '2023-06-20'),
('V02', 'Felipe', 'Gomes', '1983-09-11', 'M', '66666', 'Ortopedia', '2021-07-07'),
('V99', 'Paula', 'Mendes', '1989-02-28', 'F', '77777', NULL, '2022-10-15');
 
-- ********** TABELA FUNCIONARIO *******************
CREATE TABLE FUNCIONARIO(
ID_FUNCIONARIO INT NOT NULL AUTO_INCREMENT,
CODIGO_FUNCIONARIO CHAR(5) NOT NULL,
NOME VARCHAR(30) NOT NULL,
SOBRENOME VARCHAR(30) NOT NULL,
NOME_COMPLETO VARCHAR(100) ,
DATA_DE_NASCIMENTO DATE NOT NULL,
IDADE INT,
SEXO CHAR(1) NOT NULL,
DATA_DE_ADMISSAO DATE NOT NULL,
CARGO VARCHAR(20) NOT NULL,
TURNO VARCHAR(20) NOT NULL,
ESCALA_DE_TRABALHO CHAR(4) NOT NULL, 
TEMPO_NA_EMPRESA INT NOT NULL,

-- CHAVES:
PRIMARY KEY(ID_FUNCIONARIO)
);

-- TRIGGER QUE DÁ O VALOR DE 'TEMPO_NA_EMPRESA' DE ACORDO COM O VALOR DA 'DATA_DE_ADMISSAO':
DELIMITER $$

CREATE TRIGGER POPULAR_TEMPO_NA_EMPRESA_FUNCIONARIO
BEFORE INSERT ON FUNCIONARIO
FOR EACH ROW

BEGIN 
	SET NEW.TEMPO_NA_EMPRESA = TIMESTAMPDIFF(YEAR, NEW.DATA_DE_ADMISSAO, CURDATE());
END $$
DELIMITER ;

-- TRIGGER PARA NOME COMPLETO:
DELIMITER $$ 

CREATE TRIGGER POPULAR_NOME_COMPLETO_FUNCIONARIO
BEFORE INSERT ON FUNCIONARIO
FOR EACH ROW 
BEGIN 
	SET NEW.NOME_COMPLETO = CONCAT(NEW.NOME, ' ', NEW.SOBRENOME);
END $$

DELIMITER ;

-- TRIGGER PARA IDADE:
DELIMITER $$

CREATE TRIGGER POPULAR_IDADE_FUNCIONARIO
BEFORE INSERT ON FUNCIONARIO
FOR EACH ROW

BEGIN
	SET NEW.IDADE = TIMESTAMPDIFF(YEAR, NEW.DATA_DE_NASCIMENTO, CURDATE());
END $$

DELIMITER ;

-- POPULANDO TABELA:
INSERT INTO FUNCIONARIO 
(CODIGO_FUNCIONARIO, NOME, SOBRENOME, DATA_DE_NASCIMENTO, SEXO, DATA_DE_ADMISSAO, CARGO, TURNO, ESCALA_DE_TRABALHO)
VALUES
('F4823', 'Marcos', 'Silva', '1985-07-12', 'M', '2022-01-15', 'ATENDENTE', 'MANHA', '5X1'),
('F9361', 'Ana', 'Santos', '1990-03-22', 'F', '2023-02-10', 'VENDEDOR', 'TARDE', '5X2'),
('F1237', 'Pedro', 'Oliveira', '1982-11-05', 'M', '2021-12-01', 'ENTREGADOR', 'INTEGRAL', '6X1'),
('F7450', 'Carla', 'Ferreira', '1987-05-19', 'F', '2022-04-25', 'SERVIÇOS GERAIS', 'MANHA', '4X2'),
('F9999', 'João', 'Costa', '1992-08-30', 'M', '2023-05-10', 'SUPORTE TI', 'TARDE', '4X3'),
('F1001', 'Fernanda', 'Rodrigues', '1980-01-10', 'F', '2021-09-14', 'SEGURANÇA', 'INTEGRAL', '24X48'),
('F5512', 'Ricardo', 'Gomes', '1988-10-07', 'M', '2022-11-30', 'ATENDENTE', 'MANHA', '16X32'),
('F3204', 'Mariana', 'Martins', '1991-12-25', 'F', '2023-06-20', 'VENDEDOR', 'TARDE', '5X1'),
('F4508', 'Felipe', 'Almeida', '1983-09-11', 'M', '2021-07-07', 'ENTREGADOR', 'INTEGRAL', '5X2'),
('F8722', 'Paula', 'Pereira', '1989-02-28', 'F', '2022-10-15', 'SERVIÇOS GERAIS', 'MANHA', '6X1'),
('F6143', 'Renato', 'Silva', '1981-03-10', 'M', '2023-03-01', 'SUPORTE TI', 'TARDE', '4X2'),
('F4875', 'Roberta', 'Santos', '1986-06-18', 'F', '2021-11-12', 'SEGURANÇA', 'INTEGRAL', '4X3'),
('F2094', 'Gustavo', 'Oliveira', '1984-12-30', 'M', '2022-05-25', 'ATENDENTE', 'MANHA', '24X48'),
('F7720', 'Luciana', 'Ferreira', '1985-10-23', 'F', '2023-01-10', 'VENDEDOR', 'TARDE', '16X32'),
('F3456', 'André', 'Costa', '1990-04-05', 'M', '2021-08-15', 'ENTREGADOR', 'INTEGRAL', '5X1'),
('F9821', 'Patrícia', 'Rodrigues', '1983-11-29', 'F', '2022-12-05', 'SERVIÇOS GERAIS', 'MANHA', '5X2'),
('F1104', 'Sérgio', 'Gomes', '1979-07-07', 'M', '2023-07-20', 'SUPORTE TI', 'TARDE', '6X1'),
('F5627', 'Adriana', 'Martins', '1981-01-31', 'F', '2021-10-27', 'SEGURANÇA', 'INTEGRAL', '4X2'),
('F6741', 'Fábio', 'Almeida', '1987-02-15', 'M', '2022-09-03', 'ATENDENTE', 'MANHA', '4X3'),
('F9932', 'Isabela', 'Pereira', '1990-09-09', 'F', '2023-04-11', 'VENDEDOR', 'TARDE', '24X48'),
('F2105', 'Tiago', 'Silva', '1982-08-12', 'M', '2021-06-22', 'ENTREGADOR', 'INTEGRAL', '16X32'),
('F3349', 'Flávia', 'Santos', '1991-05-02', 'F', '2022-03-19', 'SERVIÇOS GERAIS', 'MANHA', '5X1'),
('F4120', 'Leandro', 'Oliveira', '1983-06-21', 'M', '2023-08-05', 'SUPORTE TI', 'TARDE', '5X2'),
('F5278', 'Camila', 'Ferreira', '1985-03-08', 'F', '2021-09-25', 'SEGURANÇA', 'INTEGRAL', '6X1'),
('F1684', 'Rafael', 'Costa', '1989-12-11', 'M', '2022-07-30', 'ATENDENTE', 'MANHA', '4X2'),
('F9457', 'Juliana', 'Rodrigues', '1988-11-17', 'F', '2023-03-28', 'VENDEDOR', 'TARDE', '4X3'),
('F3033', 'Bruno', 'Gomes', '1979-10-05', 'M', '2021-12-10', 'ENTREGADOR', 'INTEGRAL', '24X48'),
('F7771', 'Larissa', 'Martins', '1986-01-25', 'F', '2022-01-29', 'SERVIÇOS GERAIS', 'MANHA', '16X32'),
('F1239', 'Vitor', 'Almeida', '1990-11-04', 'M', '2023-02-14', 'SUPORTE TI', 'TARDE', '5X1'),
('F8882', 'Gabriela', 'Pereira', '1984-04-30', 'F', '2021-07-18', 'SEGURANÇA', 'INTEGRAL', '5X2'),
('F4567', 'César', 'Silva', '1987-09-15', 'M', '2022-10-07', 'ATENDENTE', 'MANHA', '6X1'),
('F6543', 'Aline', 'Santos', '1978-02-27', 'F', '2023-05-22', 'VENDEDOR', 'TARDE', '4X2'),
('F2222', 'Hugo', 'Oliveira', '1985-08-19', 'M', '2021-11-30', 'ENTREGADOR', 'INTEGRAL', '4X3'),
('F1010', 'Tatiana', 'Ferreira', '1992-07-01', 'F', '2022-04-08', 'SERVIÇOS GERAIS', 'MANHA', '24X48'),
('F3698', 'Daniel', 'Costa', '1981-06-16', 'M', '2023-01-28', 'SUPORTE TI', 'TARDE', '16X32'),
('F4781', 'Vanessa', 'Rodrigues', '1989-03-03', 'F', '2021-08-20', 'SEGURANÇA', 'INTEGRAL', '5X1'),
('F5690', 'Rodrigo', 'Gomes', '1983-02-22', 'M', '2022-06-06', 'ATENDENTE', 'MANHA', '5X2'),
('F6743', 'Beatriz', 'Martins', '1988-12-18', 'F', '2023-09-14', 'VENDEDOR', 'TARDE', '6X1'),
('F9802', 'Alexandre', 'Almeida', '1991-01-07', 'M', '2021-10-03', 'ENTREGADOR', 'INTEGRAL', '4X2'),
('F4571', 'Paulo', 'Pereira', '1984-05-26', 'M', '2022-05-17', 'SERVIÇOS GERAIS', 'MANHA', '4X3'),
('F3199', 'Mara', 'Silva', '1986-10-29', 'F', '2023-03-13', 'SUPORTE TI', 'TARDE', '24X48'),
('F2345', 'Gilson', 'Santos', '1979-09-20', 'M', '2021-12-22', 'SEGURANÇA', 'INTEGRAL', '16X32'),
('F8890', 'Nathalia', 'Oliveira', '1992-04-14', 'F', '2022-02-11', 'ATENDENTE', 'MANHA', '5X1'),
('F1009', 'Marisol', 'Ferreira', '1980-03-27', 'F', '2023-07-15', 'VENDEDOR', 'TARDE', '5X2'),
('F5566', 'Vinícius', 'Costa', '1982-11-11', 'M', '2021-09-05', 'ENTREGADOR', 'INTEGRAL', '6X1'),
('F3131', 'Sandra', 'Rodrigues', '1989-08-07', 'F', '2022-11-23', 'SERVIÇOS GERAIS', 'MANHA', '4X2'),
('F2233', 'Cláudio', 'Gomes', '1985-02-13', 'M', '2023-06-30', 'SUPORTE TI', 'TARDE', '4X3'),
('F9575', 'Elaine', 'Martins', '1987-05-06', 'F', '2021-08-02', 'SEGURANÇA', 'INTEGRAL', '24X48'),
('F4466', 'Renata', 'Almeida', '1990-10-02', 'F', '2022-09-29', 'ATENDENTE', 'MANHA', '16X32'),
('F7284', 'Julio', 'Pereira', '1984-01-21', 'M', '2023-04-05', 'VENDEDOR', 'TARDE', '5X1'),
('F9901', 'Mirela', 'Silva', '1988-03-15', 'F', '2021-07-27', 'ENTREGADOR', 'INTEGRAL', '5X2'),
('F3002', 'Leila', 'Santos', '1979-11-25', 'F', '2022-03-15', 'SERVIÇOS GERAIS', 'MANHA', '6X1'),
('F1111', 'Fábia', 'Oliveira', '1983-09-29', 'F', '2023-05-09', 'SUPORTE TI', 'TARDE', '4X2'),
('F7777', 'Sandro', 'Ferreira', '1985-12-13', 'M', '2021-10-18', 'SEGURANÇA', 'INTEGRAL', '4X3');

-- ************* TABELA CLIENTE *****************
CREATE TABLE CLIENTE(
ID_CLIENTE INT NOT NULL AUTO_INCREMENT,
CODIGO_CLIENTE CHAR(5) NOT NULL,
CPF CHAR(11) NOT NULL,
NOME VARCHAR(30) NOT NULL,
SOBRENOME VARCHAR(30) NOT NULL,
NOME_COMPLETO VARCHAR(100) ,
DATA_DE_NASCIMENTO DATE NOT NULL,
IDADE INT,
SEXO CHAR(1) NOT NULL,
TELEFONE CHAR(11) NOT NULL,
EMAIL VARCHAR(40) NOT NULL,
CIDADE_ATUAL VARCHAR(30) NOT NULL,
ESTADO_ATUAL VARCHAR(30) NOT NULL,

-- CHAVES:
PRIMARY KEY(ID_CLIENTE)
);

-- TRIGGER PARA NOME COMPLETO:
DELIMITER $$ 

CREATE TRIGGER POPULAR_NOME_COMPLETO_CLIENTE
BEFORE INSERT ON CLIENTE
FOR EACH ROW 
BEGIN 
	SET NEW.NOME_COMPLETO = CONCAT(NEW.NOME, ' ', NEW.SOBRENOME);
END $$

DELIMITER ;

-- TRIGGER PARA IDADE:
DELIMITER $$

CREATE TRIGGER POPULAR_IDADE_CLIENTE
BEFORE INSERT ON CLIENTE
FOR EACH ROW

BEGIN
	SET NEW.IDADE = TIMESTAMPDIFF(YEAR, NEW.DATA_DE_NASCIMENTO, CURDATE());
END $$

DELIMITER ;

-- POPULANDO A TABELA:
-- A INSERÇÃO DE VALORES FICOU EM UM ARQUIVO SEPARADO 'insercao_clientes.sql'. VISTO A QUANTIDADE DE VALORES.

-- ************ TABELA TIPO_DE_USUARIO ----------------
CREATE TABLE TIPO_DE_USUARIO(
NUMERO_DO_TIPO INT NOT NULL,
NOME_DO_TIPO VARCHAR(20) NOT NULL
);

-- POPULANDO OS VALORES:
INSERT INTO TIPO_DE_USUARIO(NUMERO_DO_TIPO, NOME_DO_TIPO)
VALUES
(1, 'GERENTE'),
(2, 'MÉDICO VETERINÁRIO'),
(3, 'FUNCIONARIO'),
(4, 'CLIENTE');

-- ****************** TABELA SERVICO_OFERECIDO ********************
CREATE TABLE SERVICO_OFERECIDO(
ID_SERVICO_OFERECIDO INT NOT NULL AUTO_INCREMENT,
NOME_DO_SERVICO VARCHAR(30) NOT NULL,
TIPO_DE_SERVICO VARCHAR(10) NOT NULL, 
VALOR_DO_SERVICO DECIMAL(10,2) NOT NULL,
-- CHAVES:
PRIMARY KEY(ID_SERVICO_OFERECIDO)
);

-- POPULANDO A TABELA:
INSERT INTO SERVICO_OFERECIDO (NOME_DO_SERVICO, TIPO_DE_SERVICO, VALOR_DO_SERVICO) VALUES
('Banho e Tosa', 'PRESENCIAL', 80.00),
('Consulta Veterinária', 'PRESENCIAL', 150.00),
('Vacinação', 'PRESENCIAL', 120.00),
('Adoção Online', 'ONLINE', 0.00),
('Pet Shop Virtual', 'ONLINE', 50.00),
('Adestramento Básico', 'PRESENCIAL', 300.00),
('Hotel para Pets (diária)', 'PRESENCIAL', 200.00),
('Transporte para Pets', 'PRESENCIAL', 60.00),
('Corte de Unhas', 'PRESENCIAL', 40.00),
('Hidratação de Pelos', 'PRESENCIAL', 90.00),
('Consulta Online', 'ONLINE', 100.00),
('Planejamento Nutricional', 'ONLINE', 180.00),
('Banho Aromático', 'PRESENCIAL', 100.00),
('Day Care para Pets', 'PRESENCIAL', 250.00),
('Aplicação de Medicamentos', 'PRESENCIAL', 70.00),
('Loja de Acessórios Online', 'ONLINE', 40.00),
('Passeio Monitorado', 'PRESENCIAL', 120.00),
('Sessão de Fisioterapia', 'PRESENCIAL', 220.00),
('Banho Medicamentoso', 'PRESENCIAL', 110.00),
('Check-up Veterinário Online', 'ONLINE', 130.00);

-- ************* TABELA PRODUTO *********************
-- CRIANDO TABELA:
CREATE TABLE PRODUTO(
ID_PRODUTO INT NOT NULL AUTO_INCREMENT,
NOME_DO_PRODUTO VARCHAR(50) NOT NULL,
CODIGO_DO_PRODUTO CHAR(6) NOT NULL,
PRECO_DO_PRODUTO DECIMAL(10,2) NOT NULL,
DATA_DE_CADASTRO DATE,
DATA_DE_VENCIMENTO DATE NOT NULL,
-- CHAVES:
PRIMARY KEY(ID_PRODUTO, CODIGO_DO_PRODUTO)
);

-- CRIANDO TRIGGER QUE POPULA O VALOR DE 'DATA_DE_CADASTRO' DE ACORDO COM A DATA ATUAL NO MOMENTO DO CADASTRO:
DELIMITER $$
CREATE TRIGGER POPULAR_DATA_DE_CADASTRO_PRODUTO
BEFORE INSERT ON PRODUTO
FOR EACH ROW

BEGIN
	SET NEW.DATA_DE_CADASTRO = NOW();
END $$

DELIMITER ;

-- ******************* TABELA ESTOQUE **********************
-- CRIANDO TABELA:
CREATE TABLE ESTOQUE(
NUMERO_DO_PRODUTO INT NOT NULL,
CODIGO_DO_PRODUTO CHAR(6) NOT NULL,
QUANTIDADE_EM_ESTOQUE INT NOT NULL,
VALOR_EM_MERCADORIA DECIMAL(10,2),

-- CHAVES:
CONSTRAINT CHAVE_PARA_ID_DO_PRODUTO_NO_ESTOQUE FOREIGN KEY(NUMERO_DO_PRODUTO) REFERENCES PRODUTO(ID_PRODUTO),
CONSTRAINT CHAVE_PARA_CODIGO_DO_PRODUTO_NO_ESTOQUE FOREIGN KEY(CODIGO_DO_PRODUTO) REFERENCES PRODUTO(CODIGO_DO_PODUTO)
);

/* TRIGGER QUE POPULA O VALOR DE 'VALOR_EM_MERCADORIA' A PARTIR DO PREÇO UNITÁRIO DO PRODUTO 
E DA QUANTIDADE ARMAZENADA EM ESTOQUE */
DELIMITER $$
CREATE TRIGGER POPULAR_VALOR_EM_MERCADORIA
BEFORE INSERT ON ESTOQUE
FOR EACH ROW

BEGIN 
	SET NEW.VALOR_EM_MERCADORIA = (SELECT PRECO_DO_PRODUTO FROM PRODUTO WHERE ID_PRODUTO = NEW.NUMERO_DO_PRODUTO) 
    * NEW.QUANTIDADE_EM_ESTOQUE;
END $$

DELIMITER ;

--  ************** TABELA VENDA_FEITA *******************
CREATE TABLE VENDA_FEITA(


);









